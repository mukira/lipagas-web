const e=function(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(i[e]=0,i[256|e]=32768,r[e]=24,r[256|e]=24):t<-14?(i[e]=1024>>-t-14,i[256|e]=1024>>-t-14|32768,r[e]=-t-1,r[256|e]=-t-1):t<=15?(i[e]=t+15<<10,i[256|e]=t+15<<10|32768,r[e]=13,r[256|e]=13):t<128?(i[e]=31744,i[256|e]=64512,r[e]=24,r[256|e]=24):(i[e]=31744,i[256|e]=64512,r[e]=13,r[256|e]=13)}const a=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;!(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,a[e]=t|n}for(let e=1024;e<2048;++e)a[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)s[e]=e<<23;s[31]=1199570944,s[32]=2147483648;for(let e=33;e<63;++e)s[e]=2147483648+(e-32<<23);s[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:a,exponentTable:s,offsetTable:o}}();const t=function(t){var n;Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=t,t=Math.max(-65504,Math.min(65504,n)),e.floatView[0]=t;const i=e.uint32View[0],r=i>>23&511;return e.baseTable[r]+((8388607&i)>>e.shiftTable[r])};self.onmessage=function(e){const n=e.data.type,i=e.data.buffer,r=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},a=function(e,t,n){t=t||1024;let i=e.pos,r=-1,a=0,s="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(r=o.indexOf("\n"))&&a<t&&i<e.byteLength;)s+=o,a+=o.length,i+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<r&&(!1!==n&&(e.pos+=a+r+1),s+o.slice(0,r))},s=function(e,t,n,i){const r=e[t+3],a=Math.pow(2,r-128)/255;n[i+0]=e[t+0]*a,n[i+1]=e[t+1]*a,n[i+2]=e[t+2]*a,n[i+3]=1},o=function(e,n,i,r){const a=e[n+3],s=Math.pow(2,a-128)/255;i[r+0]=t(Math.min(e[n+0]*s,65504)),i[r+1]=t(Math.min(e[n+1]*s,65504)),i[r+2]=t(Math.min(e[n+2]*s,65504)),i[r+3]=t(1)},l=new Uint8Array(i);l.pos=0;const c=function(e){const t=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;for((e.pos>=e.byteLength||!(l=a(e)))&&r(1,"no header found"),(c=l.match(/^#\?(\S+)/))||r(3,"bad initial token"),o.valid|=1,o.programtype=c[1],o.string+=l+"\n";l=a(e),!1!==l;)if(o.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(t))&&(o.gamma=parseFloat(c[1])),(c=l.match(n))&&(o.exposure=parseFloat(c[1])),(c=l.match(i))&&(o.valid|=2,o.format=c[1]),(c=l.match(s))&&(o.valid|=4,o.height=parseInt(c[1],10),o.width=parseInt(c[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=l+"\n";return 2&o.valid||r(3,"missing format specifier"),4&o.valid||r(3,"missing image size specifier"),o}(l),u=c.width,h=c.height,d=function(e,t,n){const i=t;if(i<8||i>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);i!==(e[2]<<8|e[3])&&r(3,"wrong scanline width");const a=new Uint8Array(4*t*n);a.length||r(4,"unable to allocate buffer space");let s=0,o=0;const l=4*i,c=new Uint8Array(4),u=new Uint8Array(l);let h=n;for(;h>0&&o<e.byteLength;){o+4>e.byteLength&&r(1),c[0]=e[o++],c[1]=e[o++],c[2]=e[o++],c[3]=e[o++],2==c[0]&&2==c[1]&&(c[2]<<8|c[3])==i||r(3,"bad rgbe scanline format");let t,n=0;for(;n<l&&o<e.byteLength;){t=e[o++];const i=t>128;if(i&&(t-=128),(0===t||n+t>l)&&r(3,"bad scanline data"),i){const i=e[o++];for(let e=0;e<t;e++)u[n++]=i}else u.set(e.subarray(o,o+t),n),n+=t,o+=t}const d=i;for(let e=0;e<d;e++){let t=0;a[s]=u[e+t],t+=i,a[s+1]=u[e+t],t+=i,a[s+2]=u[e+t],t+=i,a[s+3]=u[e+t],s+=4}h--}return a}(l.subarray(l.pos),u,h);let p,f,m;switch(n){case 1015:m=d.length/4;const e=new Float32Array(4*m);for(let t=0;t<m;t++)s(d,4*t,e,4*t);p=e,f=1015;break;case 1016:m=d.length/4;const t=new Uint16Array(4*m);for(let e=0;e<m;e++)o(d,4*e,t,4*e);p=t,f=1016;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+n)}const A={width:u,height:h,data:p,header:c.string,gamma:c.gamma,exposure:c.exposure,type:f};self.postMessage(A)}