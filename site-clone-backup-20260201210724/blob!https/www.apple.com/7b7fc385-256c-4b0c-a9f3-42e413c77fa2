const e=function(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(i[e]=0,i[256|e]=32768,r[e]=24,r[256|e]=24):t<-14?(i[e]=1024>>-t-14,i[256|e]=1024>>-t-14|32768,r[e]=-t-1,r[256|e]=-t-1):t<=15?(i[e]=t+15<<10,i[256|e]=t+15<<10|32768,r[e]=13,r[256|e]=13):t<128?(i[e]=31744,i[256|e]=64512,r[e]=24,r[256|e]=24):(i[e]=31744,i[256|e]=64512,r[e]=13,r[256|e]=13)}const a=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;!(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,a[e]=t|n}for(let e=1024;e<2048;++e)a[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)s[e]=e<<23;s[31]=1199570944,s[32]=2147483648;for(let e=33;e<63;++e)s[e]=2147483648+(e-32<<23);s[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:a,exponentTable:s,offsetTable:o}}();const t=function(t){var n;Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=t,t=Math.max(-65504,Math.min(65504,n)),e.floatView[0]=t;const i=e.uint32View[0],r=i>>23&511;return e.baseTable[r]+((8388607&i)>>e.shiftTable[r])};var n=Uint8Array,i=Uint16Array,r=Uint32Array,a=new n([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new n([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=function(e,t){for(var n=new i(31),a=0;a<31;++a)n[a]=t+=1<<e[a-1];var s=new r(n[30]);for(a=1;a<30;++a)for(var o=n[a];o<n[a+1];++o)s[o]=o-n[a]<<5|a;return[n,s]},l=o(a,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var h=new i(32768),d=0;d<32768;++d){var p=(43690&d)>>>1|(21845&d)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,h[d]=((65280&p)>>>8|(255&p)<<8)>>>1}var f=new n(288);for(d=0;d<144;++d)f[d]=8;for(d=144;d<256;++d)f[d]=9;for(d=256;d<280;++d)f[d]=7;for(d=280;d<288;++d)f[d]=8;var m=new n(32);for(d=0;d<32;++d)m[d]=5;const A=function(e,t){return function(e,t,l){var u=e.length;if(!u||l&&!l.l&&u<5)return t||new n(0);var d=!t||l,p=!l||l.i;l||(l={}),t||(t=new n(3*u));var A,g=function(e){var i=t.length;if(e>i){var r=new n(Math.max(2*i,e));r.set(t),t=r}},v=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},y=function(e,t,n){for(var r=e.length,a=0,s=new i(t);a<r;++a)++s[e[a]-1];var o,l=new i(t);for(a=0;a<t;++a)l[a]=l[a-1]+s[a-1]<<1;if(n){o=new i(1<<t);var c=15-t;for(a=0;a<r;++a)if(e[a])for(var u=a<<4|e[a],d=t-e[a],p=l[e[a]-1]++<<d,f=p|(1<<d)-1;p<=f;++p)o[h[p]>>>c]=u}else for(o=new i(r),a=0;a<r;++a)e[a]&&(o[a]=h[l[e[a]-1]++]>>>15-e[a]);return o},b=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},_=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},x=y(f,9,1),E=y(m,5,1),w=new n([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),M=o(s,0),S=M[0],C=(M[1],l.f||0),I=l.p||0,T=l.b||0,B=l.l,R=l.d,P=l.m,L=l.n,O=8*u;do{if(!B){l.f=C=v(e,I,1);var U=v(e,I+1,3);if(I+=3,!U){var D=e[(q=((A=I)/8|0)+(7&A&&1)+4)-4]|e[q-3]<<8,F=q+D;if(F>u){if(p)throw"unexpected EOF";break}d&&g(T+D),t.set(e.subarray(q,F),T),l.b=T+=D,l.p=I=8*F;continue}if(1==U)B=x,R=E,P=9,L=5;else{if(2!=U)throw"invalid block type";var N=v(e,I,31)+257,k=v(e,I+10,15)+4,Q=N+v(e,I+5,31)+1;I+=14;for(var G=new n(Q),V=new n(19),z=0;z<k;++z)V[w[z]]=v(e,I+3*z,7);I+=3*k;var j=b(V),H=(1<<j)-1,W=y(V,j,1);for(z=0;z<Q;){var q,X=W[v(e,I,H)];if(I+=15&X,(q=X>>>4)<16)G[z++]=q;else{var Y=0,K=0;for(16==q?(K=3+v(e,I,3),I+=2,Y=G[z-1]):17==q?(K=3+v(e,I,7),I+=3):18==q&&(K=11+v(e,I,127),I+=7);K--;)G[z++]=Y}}var J=G.subarray(0,N),Z=G.subarray(N);P=b(J),L=b(Z),B=y(J,P,1),R=y(Z,L,1)}if(I>O){if(p)throw"unexpected EOF";break}}d&&g(T+131072);for(var $=(1<<P)-1,ee=(1<<L)-1,te=I;;te=I){var ne=(Y=B[_(e,I)&$])>>>4;if((I+=15&Y)>O){if(p)throw"unexpected EOF";break}if(!Y)throw"invalid length/literal";if(ne<256)t[T++]=ne;else{if(256==ne){te=I,B=null;break}var ie=ne-254;ne>264&&(ie=v(e,I,(1<<(se=a[z=ne-257]))-1)+c[z],I+=se);var re=R[_(e,I)&ee],ae=re>>>4;if(!re)throw"invalid distance";if(I+=15&re,Z=S[ae],ae>3){var se=s[ae];Z+=_(e,I)&(1<<se)-1,I+=se}if(I>O){if(p)throw"unexpected EOF";break}d&&g(T+131072);for(var oe=T+ie;T<oe;T+=4)t[T]=t[T-Z],t[T+1]=t[T+1-Z],t[T+2]=t[T+2-Z],t[T+3]=t[T+3-Z];T=oe}}l.l=B,l.p=te,l.b=T,B&&(C=1,l.m=P,l.d=R,l.n=L)}while(!C);return T==t.length?t:function(e,t,a){(null==t||t<0)&&(t=0),(null==a||a>e.length)&&(a=e.length);var s=new(e instanceof i?i:e instanceof r?r:n)(a-t);return s.set(e.subarray(t,a)),s}(t,0,T)}((function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"}(e),e.subarray(2,-4)),t)},g=1015,v=1016,y="srgb-linear";self.onmessage=function(e){const n=e.data.type,i=e.data.buffer,r=65536,a=14,s=65537,o=1<<a,l=o-1,c=Math.pow(2.7182818,2.2),u={l:0,c:0,lc:0};function h(e,t,n,i,r){for(;n<e;)t=t<<8|Y(i,r),n+=8;n-=e,u.l=t>>n&(1<<e)-1,u.c=t,u.lc=n}const d=new Array(59);function p(e,t,n,i,r,a){const o=t;let l=0,c=0;for(;i<=r;i++){if(o.value-t.value>n)return!1;h(6,l,c,e,o);const s=u.l;if(l=u.c,c=u.lc,a[i]=s,63==s){if(o.value-t.value>n)throw new Error("Something wrong with hufUnpackEncTable");h(8,l,c,e,o);let s=u.l+6;if(l=u.c,c=u.lc,i+s>r+1)throw new Error("Something wrong with hufUnpackEncTable");for(;s--;)a[i++]=0;i--}else if(s>=59){let e=s-59+2;if(i+e>r+1)throw new Error("Something wrong with hufUnpackEncTable");for(;e--;)a[i++]=0;i--}}!function(e){for(let e=0;e<=58;++e)d[e]=0;for(let t=0;t<s;++t)d[e[t]]+=1;let t=0;for(let e=58;e>0;--e){const n=t+d[e]>>1;d[e]=t,t=n}for(let t=0;t<s;++t){const n=e[t];n>0&&(e[t]=n|d[n]++<<6)}}(a)}function f(e){return 63&e}function m(e){return e>>6}const b={c:0,lc:0};function _(e,t,n,i){e=e<<8|Y(n,i),t+=8,b.c=e,b.lc=t}const x={c:0,lc:0};function E(e,t,n,i,r,a,s,o,l){if(e==t){i<8&&(_(n,i,r,a),n=b.c,i=b.lc);let e=n>>(i-=8);if(e=new Uint8Array([e])[0],o.value+e>l)return!1;const t=s[o.value-1];for(;e-- >0;)s[o.value++]=t}else{if(!(o.value<l))return!1;s[o.value++]=e}x.c=n,x.lc=i}function w(e){return 65535&e}function M(e){const t=w(e);return t>32767?t-65536:t}const S={a:0,b:0};function C(e,t){const n=M(e),i=M(t),r=n+(1&i)+(i>>1),a=r,s=r-i;S.a=a,S.b=s}function I(e,t){const n=w(e),i=w(t),r=n-(i>>1)&65535,a=i+r-32768&65535;S.a=a,S.b=r}function T(e,t,n,i,r,a,s){const o=s<16384,l=n>r?r:n;let c,u,h=1;for(;h<=l;)h<<=1;for(h>>=1,c=h,h>>=1;h>=1;){u=0;const s=u+a*(r-c),l=a*h,d=a*c,p=i*h,f=i*c;let m,A,g,v;for(;u<=s;u+=d){let r=u;const a=u+i*(n-c);for(;r<=a;r+=f){const n=r+p,i=r+l,a=i+p;o?(C(e[r+t],e[i+t]),m=S.a,g=S.b,C(e[n+t],e[a+t]),A=S.a,v=S.b,C(m,A),e[r+t]=S.a,e[n+t]=S.b,C(g,v),e[i+t]=S.a,e[a+t]=S.b):(I(e[r+t],e[i+t]),m=S.a,g=S.b,I(e[n+t],e[a+t]),A=S.a,v=S.b,I(m,A),e[r+t]=S.a,e[n+t]=S.b,I(g,v),e[i+t]=S.a,e[a+t]=S.b)}if(n&h){const n=r+l;o?C(e[r+t],e[n+t]):I(e[r+t],e[n+t]),m=S.a,e[n+t]=S.b,e[r+t]=m}}if(r&h){let r=u;const a=u+i*(n-c);for(;r<=a;r+=f){const n=r+p;o?C(e[r+t],e[n+t]):I(e[r+t],e[n+t]),m=S.a,e[n+t]=S.b,e[r+t]=m}}c=h,h>>=1}return u}function B(e,t,n,i,r,c){const u=n.value,h=X(t,n),d=X(t,n);n.value+=4;const A=X(t,n);if(n.value+=4,h<0||h>=s||d<0||d>=s)throw new Error("Something wrong with HUF_ENCSIZE");const g=new Array(s),v=new Array(o);if(function(e){for(let t=0;t<o;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(v),p(e,n,i-(n.value-u),h,d,g),A>8*(i-(n.value-u)))throw new Error("Something wrong with hufUncompress");!function(e,t,n,i){for(;t<=n;t++){const n=m(e[t]),r=f(e[t]);if(n>>r)throw new Error("Invalid table entry");if(r>a){const e=i[n>>r-a];if(e.len)throw new Error("Invalid table entry");if(e.lit++,e.p){const t=e.p;e.p=new Array(e.lit);for(let n=0;n<e.lit-1;++n)e.p[n]=t[n]}else e.p=new Array(1);e.p[e.lit-1]=t}else if(r){let e=0;for(let s=1<<a-r;s>0;s--){const s=i[(n<<a-r)+e];if(s.len||s.p)throw new Error("Invalid table entry");s.len=r,s.lit=t,e++}}}}(g,h,d,v),function(e,t,n,i,r,s,o,c,u){let h=0,d=0;const p=o,A=Math.trunc(i.value+(r+7)/8);for(;i.value<A;)for(_(h,d,n,i),h=b.c,d=b.lc;d>=a;){const r=t[h>>d-a&l];if(r.len)d-=r.len,E(r.lit,s,h,d,n,i,c,u,p),h=x.c,d=x.lc;else{if(!r.p)throw new Error("hufDecode issues");let t;for(t=0;t<r.lit;t++){const a=f(e[r.p[t]]);for(;d<a&&i.value<A;)_(h,d,n,i),h=b.c,d=b.lc;if(d>=a&&m(e[r.p[t]])==(h>>d-a&(1<<a)-1)){d-=a,E(r.p[t],s,h,d,n,i,c,u,p),h=x.c,d=x.lc;break}}if(t==r.lit)throw new Error("hufDecode issues")}}const g=8-r&7;for(h>>=g,d-=g;d>0;){const e=t[h<<a-d&l];if(!e.len)throw new Error("hufDecode issues");d-=e.len,E(e.lit,s,h,d,n,i,c,u,p),h=x.c,d=x.lc}}(g,v,e,n,A,d,c,r,{value:0})}function R(e){for(let t=1;t<e.length;t++){const n=e[t-1]+e[t]-128;e[t]=n}}function P(e,t){let n=0,i=Math.floor((e.length+1)/2),r=0;const a=e.length-1;for(;!(r>a||(t[r++]=e[n++],r>a));)t[r++]=e[i++]}function L(e){let t=e.byteLength;const n=new Array;let i=0;const r=new DataView(e);for(;t>0;){const e=r.getInt8(i++);if(e<0){const a=-e;t-=a+1;for(let e=0;e<a;e++)n.push(r.getUint8(i++))}else{const a=e;t-=2;const s=r.getUint8(i++);for(let e=0;e<a+1;e++)n.push(s)}}return n}function O(e,t,n){let i,r=1;for(;r<64;)i=t[e.value],65280==i?r=64:i>>8==255?r+=255&i:(n[r]=i,r++),e.value++}function U(e,t){t[0]=ee(e[0]),t[1]=ee(e[1]),t[2]=ee(e[5]),t[3]=ee(e[6]),t[4]=ee(e[14]),t[5]=ee(e[15]),t[6]=ee(e[27]),t[7]=ee(e[28]),t[8]=ee(e[2]),t[9]=ee(e[4]),t[10]=ee(e[7]),t[11]=ee(e[13]),t[12]=ee(e[16]),t[13]=ee(e[26]),t[14]=ee(e[29]),t[15]=ee(e[42]),t[16]=ee(e[3]),t[17]=ee(e[8]),t[18]=ee(e[12]),t[19]=ee(e[17]),t[20]=ee(e[25]),t[21]=ee(e[30]),t[22]=ee(e[41]),t[23]=ee(e[43]),t[24]=ee(e[9]),t[25]=ee(e[11]),t[26]=ee(e[18]),t[27]=ee(e[24]),t[28]=ee(e[31]),t[29]=ee(e[40]),t[30]=ee(e[44]),t[31]=ee(e[53]),t[32]=ee(e[10]),t[33]=ee(e[19]),t[34]=ee(e[23]),t[35]=ee(e[32]),t[36]=ee(e[39]),t[37]=ee(e[45]),t[38]=ee(e[52]),t[39]=ee(e[54]),t[40]=ee(e[20]),t[41]=ee(e[22]),t[42]=ee(e[33]),t[43]=ee(e[38]),t[44]=ee(e[46]),t[45]=ee(e[51]),t[46]=ee(e[55]),t[47]=ee(e[60]),t[48]=ee(e[21]),t[49]=ee(e[34]),t[50]=ee(e[37]),t[51]=ee(e[47]),t[52]=ee(e[50]),t[53]=ee(e[56]),t[54]=ee(e[59]),t[55]=ee(e[61]),t[56]=ee(e[35]),t[57]=ee(e[36]),t[58]=ee(e[48]),t[59]=ee(e[49]),t[60]=ee(e[57]),t[61]=ee(e[58]),t[62]=ee(e[62]),t[63]=ee(e[63])}function D(e){const t=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),i=.5*Math.cos(3.14159/8),r=.5*Math.cos(3*3.14159/16),a=.5*Math.cos(.981746875),s=.5*Math.cos(3*3.14159/8),o=.5*Math.cos(1.374445625),l=new Array(4),c=new Array(4),u=new Array(4),h=new Array(4);for(let d=0;d<8;++d){const p=8*d;l[0]=i*e[p+2],l[1]=s*e[p+2],l[2]=i*e[p+6],l[3]=s*e[p+6],c[0]=n*e[p+1]+r*e[p+3]+a*e[p+5]+o*e[p+7],c[1]=r*e[p+1]-o*e[p+3]-n*e[p+5]-a*e[p+7],c[2]=a*e[p+1]-n*e[p+3]+o*e[p+5]+r*e[p+7],c[3]=o*e[p+1]-a*e[p+3]+r*e[p+5]-n*e[p+7],u[0]=t*(e[p+0]+e[p+4]),u[3]=t*(e[p+0]-e[p+4]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[p+0]=h[0]+c[0],e[p+1]=h[1]+c[1],e[p+2]=h[2]+c[2],e[p+3]=h[3]+c[3],e[p+4]=h[3]-c[3],e[p+5]=h[2]-c[2],e[p+6]=h[1]-c[1],e[p+7]=h[0]-c[0]}for(let d=0;d<8;++d)l[0]=i*e[16+d],l[1]=s*e[16+d],l[2]=i*e[48+d],l[3]=s*e[48+d],c[0]=n*e[8+d]+r*e[24+d]+a*e[40+d]+o*e[56+d],c[1]=r*e[8+d]-o*e[24+d]-n*e[40+d]-a*e[56+d],c[2]=a*e[8+d]-n*e[24+d]+o*e[40+d]+r*e[56+d],c[3]=o*e[8+d]-a*e[24+d]+r*e[40+d]-n*e[56+d],u[0]=t*(e[d]+e[32+d]),u[3]=t*(e[d]-e[32+d]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[0+d]=h[0]+c[0],e[8+d]=h[1]+c[1],e[16+d]=h[2]+c[2],e[24+d]=h[3]+c[3],e[32+d]=h[3]-c[3],e[40+d]=h[2]-c[2],e[48+d]=h[1]-c[1],e[56+d]=h[0]-c[0]}function F(e){for(let t=0;t<64;++t){const n=e[0][t],i=e[1][t],r=e[2][t];e[0][t]=n+1.5747*r,e[1][t]=n-.1873*i-.4682*r,e[2][t]=n+1.8556*i}}function N(e,n,i){for(let r=0;r<64;++r)n[i+r]=t(k(e[r]))}function k(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(c,Math.abs(e)-1)}function Q(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function G(e){const t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(L(t)),i=new Uint8Array(n.length);return R(n),P(n,i),new DataView(i.buffer)}function V(e){const t=e.array.slice(e.offset.value,e.offset.value+e.size),n=A(t),i=new Uint8Array(n.length);return R(n),P(n,i),new DataView(i.buffer)}function z(e){const t=e.viewer,n={value:e.offset.value},i=new Uint16Array(e.columns*e.lines*(e.inputChannels.length*e.type)),a=new Uint8Array(8192);let s=0;const o=new Array(e.inputChannels.length);for(let t=0,n=e.inputChannels.length;t<n;t++)o[t]={},o[t].start=s,o[t].end=o[t].start,o[t].nx=e.columns,o[t].ny=e.lines,o[t].size=e.type,s+=o[t].nx*o[t].ny*o[t].size;const l=te(t,n),c=te(t,n);if(c>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(l<=c)for(let e=0;e<c-l+1;e++)a[e+l]=K(t,n);const u=new Uint16Array(r),h=function(e,t){let n=0;for(let i=0;i<r;++i)(0==i||e[i>>3]&1<<(7&i))&&(t[n++]=i);const i=n-1;for(;n<r;)t[n++]=0;return i}(a,u),d=X(t,n);B(e.array,t,n,d,i,s);for(let t=0;t<e.inputChannels.length;++t){const e=o[t];for(let n=0;n<o[t].size;++n)T(i,e.start+n,e.nx,e.size,e.ny,e.nx*e.size,h)}!function(e,t,n){for(let i=0;i<n;++i)t[i]=e[t[i]]}(u,i,s);let p=0;const f=new Uint8Array(i.buffer.byteLength);for(let t=0;t<e.lines;t++)for(let t=0;t<e.inputChannels.length;t++){const e=o[t],n=e.nx*e.size,r=new Uint8Array(i.buffer,2*e.end,2*n);f.set(r,p),p+=2*n,e.end+=n}return new DataView(f.buffer)}function j(e){const t=e.array.slice(e.offset.value,e.offset.value+e.size),n=A(t),i=e.inputChannels.length*e.lines*e.columns*e.totalBytes,r=new ArrayBuffer(i),a=new DataView(r);let s=0,o=0;const l=new Array(4);for(let t=0;t<e.lines;t++)for(let t=0;t<e.inputChannels.length;t++){let i=0;switch(e.inputChannels[t].pixelType){case 1:l[0]=s,l[1]=l[0]+e.columns,s=l[1]+e.columns;for(let t=0;t<e.columns;++t)i+=n[l[0]++]<<8|n[l[1]++],a.setUint16(o,i,!0),o+=2;break;case 2:l[0]=s,l[1]=l[0]+e.columns,l[2]=l[1]+e.columns,s=l[2]+e.columns;for(let t=0;t<e.columns;++t)i+=n[l[0]++]<<24|n[l[1]++]<<16|n[l[2]++]<<8,a.setUint32(o,i,!0),o+=4}}return a}function H(e){const t=e.viewer,n={value:e.offset.value},i=new Uint8Array(e.columns*e.lines*(e.inputChannels.length*e.type*2)),r={version:J(t,n),unknownUncompressedSize:J(t,n),unknownCompressedSize:J(t,n),acCompressedSize:J(t,n),dcCompressedSize:J(t,n),rleCompressedSize:J(t,n),rleUncompressedSize:J(t,n),rleRawSize:J(t,n),totalAcUncompressedCount:J(t,n),totalDcUncompressedCount:J(t,n),acCompression:J(t,n)};if(r.version<2)throw new Error("EXRLoader.parse: "+ue.compression+" version "+r.version+" is unsupported");const a=new Array;let s=te(t,n)-2;for(;s>0;){const e=W(t.buffer,n),i=K(t,n),r=i>>2&3,o=new Int8Array([(i>>4)-1])[0],l=K(t,n);a.push({name:e,index:o,type:l,compression:r}),s-=e.length+3}const o=ue.channels,l=new Array(e.inputChannels.length);for(let t=0;t<e.inputChannels.length;++t){const n=l[t]={},i=o[t];n.name=i.name,n.compression=0,n.decoded=!1,n.type=i.pixelType,n.pLinear=i.pLinear,n.width=e.columns,n.height=e.lines}const c={idx:new Array(3)};for(let t=0;t<e.inputChannels.length;++t){const e=l[t];for(let n=0;n<a.length;++n){const i=a[n];e.name==i.name&&(e.compression=i.compression,i.index>=0&&(c.idx[i.index]=t),e.offset=t)}}let u,h,d;if(r.acCompressedSize>0)switch(r.acCompression){case 0:u=new Uint16Array(r.totalAcUncompressedCount),B(e.array,t,n,r.acCompressedSize,u,r.totalAcUncompressedCount);break;case 1:const i=e.array.slice(n.value,n.value+r.totalAcUncompressedCount),a=A(i);u=new Uint16Array(a.buffer),n.value+=r.totalAcUncompressedCount}if(r.dcCompressedSize>0){const t={array:e.array,offset:n,size:r.dcCompressedSize};h=new Uint16Array(V(t).buffer),n.value+=r.dcCompressedSize}if(r.rleRawSize>0){const t=e.array.slice(n.value,n.value+r.rleCompressedSize);d=L(A(t).buffer),n.value+=r.rleCompressedSize}let p=0;const f=new Array(l.length);for(let e=0;e<f.length;++e)f[e]=new Array;for(let t=0;t<e.lines;++t)for(let t=0;t<l.length;++t)f[t].push(p),p+=l[t].width*e.type*2;!function(e,t,n,i,r,a){let s=new DataView(a.buffer);const o=n[e.idx[0]].width,l=n[e.idx[0]].height,c=Math.floor(o/8),u=Math.ceil(o/8),h=Math.ceil(l/8),d=o-8*(u-1),p=l-8*(h-1),f={value:0},m=new Array(3),A=new Array(3),g=new Array(3),v=new Array(3),y=new Array(3);for(let n=0;n<3;++n)y[n]=t[e.idx[n]],m[n]=n<1?0:m[n-1]+u*h,A[n]=new Float32Array(64),g[n]=new Uint16Array(64),v[n]=new Uint16Array(64*u);for(let t=0;t<h;++t){let a=8;t==h-1&&(a=p);let o=8;for(let e=0;e<u;++e){e==u-1&&(o=d);for(let e=0;e<3;++e)g[e].fill(0),g[e][0]=r[m[e]++],O(f,i,g[e]),U(g[e],A[e]),D(A[e]);F(A);for(let t=0;t<3;++t)N(A[t],v[t],64*e)}let l=0;for(let i=0;i<3;++i){const r=n[e.idx[i]].type;for(let e=8*t;e<8*t+a;++e){l=y[i][e];for(let t=0;t<c;++t){const n=64*t+8*(7&e);s.setUint16(l+0*r,v[i][n+0],!0),s.setUint16(l+2*r,v[i][n+1],!0),s.setUint16(l+4*r,v[i][n+2],!0),s.setUint16(l+6*r,v[i][n+3],!0),s.setUint16(l+8*r,v[i][n+4],!0),s.setUint16(l+10*r,v[i][n+5],!0),s.setUint16(l+12*r,v[i][n+6],!0),s.setUint16(l+14*r,v[i][n+7],!0),l+=16*r}}if(c!=u)for(let e=8*t;e<8*t+a;++e){const t=y[i][e]+8*c*2*r,n=64*c+8*(7&e);for(let e=0;e<o;++e)s.setUint16(t+2*e*r,v[i][n+e],!0)}}}const b=new Uint16Array(o);s=new DataView(a.buffer);for(let t=0;t<3;++t){n[e.idx[t]].decoded=!0;const i=n[e.idx[t]].type;if(2==n[t].type)for(let e=0;e<l;++e){const n=y[t][e];for(let e=0;e<o;++e)b[e]=s.getUint16(n+2*e*i,!0);for(let e=0;e<o;++e)s.setFloat32(n+2*e*i,ee(b[e]),!0)}}}(c,f,l,u,h,i);for(let t=0;t<l.length;++t){const n=l[t];if(!n.decoded){if(2!==n.compression)throw new Error("EXRLoader.parse: unsupported channel compression");{let r=0,a=0;for(let s=0;s<e.lines;++s){let e=f[t][r];for(let t=0;t<n.width;++t){for(let t=0;t<2*n.type;++t)i[e++]=d[a+t*n.width*n.height];a++}r++}}}}return new DataView(i.buffer)}function W(e,t){const n=new Uint8Array(e);let i=0;for(;0!=n[t.value+i];)i+=1;const r=(new TextDecoder).decode(n.slice(t.value,t.value+i));return t.value=t.value+i+1,r}function q(e,t){const n=e.getInt32(t.value,!0);return t.value=t.value+4,n}function X(e,t){const n=e.getUint32(t.value,!0);return t.value=t.value+4,n}function Y(e,t){const n=e[t.value];return t.value=t.value+1,n}function K(e,t){const n=e.getUint8(t.value);return t.value=t.value+1,n}const J=function(e,t){let n;return n="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function Z(e,t){const n=e.getFloat32(t.value,!0);return t.value+=4,n}function $(e,n){return t(Z(e,n))}function ee(e){const t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}function te(e,t){const n=e.getUint16(t.value,!0);return t.value+=2,n}function ne(e,t){return ee(te(e,t))}function ie(e,t,n,i,r){return"string"===i||"stringvector"===i||"iccProfile"===i?function(e,t,n){const i=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,i}(t,n,r):"chlist"===i?function(e,t,n,i){const r=n.value,a=[];for(;n.value<r+i-1;){const i=W(t,n),r=q(e,n),s=K(e,n);n.value+=3;const o=q(e,n),l=q(e,n);a.push({name:i,pixelType:r,pLinear:s,xSampling:o,ySampling:l})}return n.value+=1,a}(e,t,n,r):"chromaticities"===i?function(e,t){return{redX:Z(e,t),redY:Z(e,t),greenX:Z(e,t),greenY:Z(e,t),blueX:Z(e,t),blueY:Z(e,t),whiteX:Z(e,t),whiteY:Z(e,t)}}(e,n):"compression"===i?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][K(e,t)]}(e,n):"box2i"===i?function(e,t){return{xMin:q(e,t),yMin:q(e,t),xMax:q(e,t),yMax:q(e,t)}}(e,n):"envmap"===i?function(e,t){return["ENVMAP_LATLONG","ENVMAP_CUBE"][K(e,t)]}(e,n):"tiledesc"===i?function(e,t){const n=X(e,t),i=X(e,t),r=K(e,t);return{xSize:n,ySize:i,levelMode:["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"][15&r],roundingMode:["ROUND_DOWN","ROUND_UP"][r>>4]}}(e,n):"lineOrder"===i?function(e,t){return["INCREASING_Y","DECREASING_Y","RANDOM_Y"][K(e,t)]}(e,n):"float"===i?Z(e,n):"v2f"===i?function(e,t){return[Z(e,t),Z(e,t)]}(e,n):"v3f"===i?function(e,t){return[Z(e,t),Z(e,t),Z(e,t)]}(e,n):"int"===i?q(e,n):"rational"===i?function(e,t){return[q(e,t),X(e,t)]}(e,n):"timecode"===i?function(e,t){return[X(e,t),X(e,t)]}(e,n):"preview"===i?(n.value+=r,"skipped"):void(n.value+=r)}function re(e,t,n,i){const r=new Array(e);for(let a=0;a<e;a++){const e=1<<a;let s=t/e|0;"ROUND_UP"==i&&s*e<t&&(s+=1);const o=Math.max(s,1);r[a]=(o+n-1)/n|0}return r}function ae(){const e=this,t=e.offset,n={value:0};for(let i=0;i<e.tileCount;i++){const i=q(e.viewer,t),r=q(e.viewer,t);t.value+=8,e.size=X(e.viewer,t);const a=i*e.blockWidth,s=r*e.blockHeight;e.columns=a+e.blockWidth>e.width?e.width-a:e.blockWidth,e.lines=s+e.blockHeight>e.height?e.height-s:e.blockHeight;const o=e.columns*e.totalBytes,l=e.size<e.lines*o?e.uncompress(e):Q(e);t.value+=e.size;for(let t=0;t<e.lines;t++){const i=t*e.columns*e.totalBytes;for(let r=0;r<e.inputChannels.length;r++){const o=ue.channels[r].name,c=e.channelByteOffsets[o]*e.columns,u=e.decodeChannels[o];if(void 0===u)continue;n.value=i+c;const h=(e.height-(1+s+t))*e.outLineWidth;for(let t=0;t<e.columns;t++){const i=h+(t+a)*e.outputChannels+u;e.byteArray[i]=e.getter(l,n)}}}}}function se(){const e=this,t=e.offset,n={value:0};for(let i=0;i<e.height/e.blockHeight;i++){const r=q(e.viewer,t)-ue.dataWindow.yMin;e.size=X(e.viewer,t),e.lines=r+e.blockHeight>e.height?e.height-r:e.blockHeight;const a=e.columns*e.totalBytes,s=e.size<e.lines*a?e.uncompress(e):Q(e);t.value+=e.size;for(let t=0;t<e.blockHeight;t++){const r=i*e.blockHeight,o=t+e.scanOrder(r);if(o>=e.height)continue;const l=t*a,c=(e.height-1-o)*e.outLineWidth;for(let t=0;t<e.inputChannels.length;t++){const i=ue.channels[t].name,r=e.channelByteOffsets[i]*e.columns,a=e.decodeChannels[i];if(void 0!==a){n.value=l+r;for(let t=0;t<e.columns;t++){const i=c+t*e.outputChannels+a;e.byteArray[i]=e.getter(s,n)}}}}}}const oe={value:0},le=new DataView(i),ce=new Uint8Array(i),ue=function(e,t,n){const i={};if(20000630!=e.getUint32(0,!0))throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");i.version=e.getUint8(4);const r=e.getUint8(5);i.spec={singleTile:!!(2&r),longName:!!(4&r),deepFormat:!!(8&r),multiPart:!!(16&r)},n.value=8;let a=!0;for(;a;){const r=W(t,n);if(0==r)a=!1;else{const a=W(t,n),s=ie(e,t,n,a,X(e,n));void 0===s?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${a}'.`):i[r]=s}}if(-7&r)throw console.error("THREE.EXRHeader:",i),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return i}(le,i,oe),he=function(e,t,n,i,r){const a={size:0,viewer:t,array:n,offset:i,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,inputChannels:e.channels,channelByteOffsets:{},scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:y};switch(e.compression){case"NO_COMPRESSION":a.blockHeight=1,a.uncompress=Q;break;case"RLE_COMPRESSION":a.blockHeight=1,a.uncompress=G;break;case"ZIPS_COMPRESSION":a.blockHeight=1,a.uncompress=V;break;case"ZIP_COMPRESSION":a.blockHeight=16,a.uncompress=V;break;case"PIZ_COMPRESSION":a.blockHeight=32,a.uncompress=z;break;case"PXR24_COMPRESSION":a.blockHeight=16,a.uncompress=j;break;case"DWAA_COMPRESSION":a.blockHeight=32,a.uncompress=H;break;case"DWAB_COMPRESSION":a.blockHeight=256,a.uncompress=H;break;default:throw new Error("EXRLoader.parse: "+e.compression+" is unsupported")}const s={};for(const t of e.channels)switch(t.name){case"Y":case"R":case"G":case"B":case"A":s[t.name]=!0,a.type=t.pixelType}let o=!1;if(s.R&&s.G&&s.B)o=!s.A,a.outputChannels=4,a.decodeChannels={R:0,G:1,B:2,A:3};else{if(!s.Y)throw new Error("EXRLoader.parse: file contains unsupported data channels.");a.outputChannels=1,a.decodeChannels={Y:0}}if(1==a.type)switch(r){case g:a.getter=ne;break;case v:a.getter=te}else{if(2!=a.type)throw new Error("EXRLoader.parse: unsupported pixelType "+a.type+" for "+e.compression+".");switch(r){case g:a.getter=Z;break;case v:a.getter=$}}a.columns=a.width;const l=a.width*a.height*a.outputChannels;switch(r){case g:a.byteArray=new Float32Array(l),o&&a.byteArray.fill(1,0,l);break;case v:a.byteArray=new Uint16Array(l),o&&a.byteArray.fill(15360,0,l);break;default:console.error("THREE.EXRLoader: unsupported type: ",r)}let c=0;for(const t of e.channels)void 0!==a.decodeChannels[t.name]&&(a.channelByteOffsets[t.name]=c),c+=2*t.pixelType;if(a.totalBytes=c,a.outLineWidth=a.width*a.outputChannels,"INCREASING_Y"===e.lineOrder?a.scanOrder=e=>e:a.scanOrder=e=>a.height-1-e,4==a.outputChannels?(a.format=1023,a.colorSpace=y):(a.format=1028,a.colorSpace=""),e.spec.singleTile){a.blockHeight=e.tiles.ySize,a.blockWidth=e.tiles.xSize;const n=function(e,t,n){let i=0;switch(e.levelMode){case"ONE_LEVEL":i=1;break;case"MIPMAP_LEVELS":i=function(e,t){const n=Math.log2(e);return"ROUND_DOWN"==t?Math.floor(n):Math.ceil(n)}(Math.max(t,n),e.roundingMode)+1;break;case"RIPMAP_LEVELS":throw new Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return i}(e.tiles,a.width,a.height),r=re(n,a.width,e.tiles.xSize,e.tiles.roundingMode),s=re(n,a.height,e.tiles.ySize,e.tiles.roundingMode);a.tileCount=r[0]*s[0];for(let e=0;e<n;e++)for(let n=0;n<s[e];n++)for(let n=0;n<r[e];n++)J(t,i);a.decode=ae.bind(a)}else{a.blockWidth=a.width;const e=Math.ceil(a.height/a.blockHeight);for(let n=0;n<e;n++)J(t,i);a.decode=se.bind(a)}return a}(ue,le,ce,oe,n);he.decode();const de={header:ue,width:he.width,height:he.height,data:he.byteArray,format:he.format,colorSpace:he.colorSpace,type:n};self.postMessage(de,[he.byteArray.buffer])}